(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/studentPart/studentPart"],{"17d5":function(e,t,n){"use strict";n.r(t);var r=n("fb53"),s=n("8198");for(var o in s)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(o);n("48eb");var i=n("f0c5"),u=Object(i["a"])(s["default"],r["b"],r["c"],!1,null,"b8e31cec",null,!1,r["a"],void 0);t["default"]=u.exports},"2d34":function(e,t,n){"use strict";(function(e,r){var s=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(n("2eee")),i=s(n("c973")),u=n("1ef5");function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l={name:"studentPart",props:{userData:{type:Object,default:{}},token:{type:String,default:""}},data:function(){return{active:0,selectedCourse:{},stuCourseInfoList:[],currentTime:"",currentDate:"",withinTheClockingTime:!1,isPunch:!1,interval:{},stuPhoto:"",showPage:!1,imageWidth:"",imageHeight:""}},options:{styleIsolation:"shared"},created:function(){this.getCurrentDate(),setInterval(this.getNowTime,1e3),this.getCourseIdList(this.token,this.userData.code,this.userData.school)},methods:{showDrawer:function(e){this.$refs[e].open()},closeDrawer:function(e){this.$refs[e].close()},change:function(e,t){this[t]=e},punchTheClock:function(){var e=this;return(0,i.default)(o.default.mark((function t(){return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.withinTheClockingTime){t.next=4;break}e.isPunch||("定位打卡"===e.selectedCourse.method?e.positioningPunch():"普通打卡"===e.selectedCourse.method?e.clockSuccessfull():e.takePhoto()),t.next=5;break;case 4:return t.abrupt("return");case 5:case"end":return t.stop()}}),t)})))()},takePhoto:function(){var t=this;e.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["camera"],success:function(e){t.imageToBase64(e.tempFilePaths[0])}})},imageToBase64:function(e){var t=this;(0,u.pathToBase64)(e).then((function(e){t.faseDetect(e)})).catch((function(e){console.error(e)}))},faseDetect:function(t){var n=this;return(0,i.default)(o.default.mark((function s(){var i,u;return o.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return i=r.importObject("clockHelper"),s.next=3,i.faseDetect(n.token,t);case 3:u=s.sent,201===u.code?n.clockSuccessfull():e.$showMsg(u.message,"error");case 5:case"end":return s.stop()}}),s)})))()},clockSuccessfull:function(){var t=this;return(0,i.default)(o.default.mark((function n(){var s,i,u;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return s=r.importObject("clockHelper"),i={course_id:t.selectedCourse._id,code:t.userData.code,name:t.userData.name,date:t.currentDate},n.next=4,s.punchTheClock(t.token,i);case 4:u=n.sent,200===u.code?(e.$showMsg(u.message,"success"),t.isPunch=!0):e.$showMsg(u.message,"none");case 6:case"end":return n.stop()}}),n)})))()},positioningPunch:function(){var t=this;e.getLocation({type:"wgs84",success:function(n){console.log(n.longitude,n.latitude),console.log(t.selectedCourse.location.longitude,t.selectedCourse.location.latitude);var r=Math.abs(n.longitude-t.selectedCourse.location.longitude),s=Math.abs(n.latitude-t.selectedCourse.location.latitude);r<=.5&&s<=.5?t.clockSuccessfull():e.$showMsg("当前位置不符合打卡要求","none")}})},activeChanged:function(e){var t=this;this.active=e,clearInterval(this.interval),this.selectedCourse=this.stuCourseInfoList[e],this.$nextTick((function(){t.$refs.collapse.resize()})),this.withinTheClockingTime=!1,this.isPunch=!1,this.checkPunchOrNot()},openLocation:function(t,n){"定位打卡"===this.selectedCourse.method&&t&&n&&e.openLocation({latitude:t,longitude:n,fail:function(){e.$showMsg("地图调用失败","error")}})},getCurrentDate:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate();this.currentDate=t+"."+n+"."+r},getNowTime:function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),r=e.getSeconds();t=t<=9?"0"+t:t,n=n<=9?"0"+n:n,r=r<=9?"0"+r:r,this.currentTime=t+":"+n+":"+r},stuGetCourseInfo:function(t,n){return(0,i.default)(o.default.mark((function s(){var i,u;return o.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return i=r.importObject("courseHelper"),s.next=3,i.getCourseInfo(t,n);case 3:if(u=s.sent,403!==u.code){s.next=9;break}return e.$showMsg(u.message,"none"),s.abrupt("return");case 9:return s.abrupt("return",u);case 10:case"end":return s.stop()}}),s)})))()},checkIsWithinTheDate:function(){var e,t=this.selectedCourse.clockList,n=new Date,r=n.getDay(),s=new Map([["日",0],["一",1],["二",2],["三",3],["四",4],["五",5],["六",6]]),o=c(t);try{for(o.s();!(e=o.n()).done;){var i=e.value;if(s.get(i.date)===r)return{isPunchTheClock:!0,timeOfStart:i.timeOfStart,timeOfEnd:i.timeOfEnd}}}catch(u){o.e(u)}finally{o.f()}return{isPunchTheClock:!1}},timeStrToStamp:function(e){var t=+e.split(":")[0],n=+e.split(":")[1],r=3600*t+60*n;return r},checkIsPunchTheClock:function(e){var t=new Date,n=this.timeStrToStamp(e.timeOfStart),r=this.timeStrToStamp(e.timeOfEnd),s=3600*t.getHours()+60*t.getMinutes()+t.getSeconds();this.withinTheClockingTime=n<=s&&r>=s},checkPunchOrNot:function(){var e=this;return(0,i.default)(o.default.mark((function t(){var n,s,i;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.checkIsWithinTheDate(),!n.isPunchTheClock){t.next=7;break}return s=r.importObject("clockHelper"),t.next=5,s.checkAlreadyPunch(e.token,e.currentDate,e.selectedCourse._id,e.userData.code);case 5:i=t.sent,i?e.isPunch=!0:e.interval=setInterval(e.checkIsPunchTheClock,1e3,n);case 7:case"end":return t.stop()}}),t)})))()},getCourseIdList:function(t,n,s){var u=this;return(0,i.default)(o.default.mark((function i(){var a,l,f,h,d,p;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return a=r.importObject("courseHelper"),o.next=3,a.getCourInfoAccordingToStuInfo(t,n,s);case 3:if(l=o.sent,402!==l.code){o.next=8;break}e.$showMsg(l.message,"error"),o.next=28;break;case 8:f=c(l),o.prev=9,f.s();case 11:if((h=f.n()).done){o.next=19;break}return d=h.value,o.next=15,u.stuGetCourseInfo(t,d);case 15:p=o.sent,u.stuCourseInfoList.push(p);case 17:o.next=11;break;case 19:o.next=24;break;case 21:o.prev=21,o.t0=o["catch"](9),f.e(o.t0);case 24:return o.prev=24,f.f(),o.finish(24);case 27:u.stuCourseInfoList.length?(u.showPage=!0,u.selectedCourse=u.stuCourseInfoList[0],u.checkPunchOrNot()):u.showPage=!0;case 28:case"end":return o.stop()}}),i,null,[[9,21,24,27]])})))()}}};t.default=l}).call(this,n("543d")["default"],n("a9ff")["default"])},"48eb":function(e,t,n){"use strict";var r=n("a1c3"),s=n.n(r);s.a},8198:function(e,t,n){"use strict";n.r(t);var r=n("2d34"),s=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=s.a},a1c3:function(e,t,n){},fb53:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={uniCollapse:function(){return n.e("uni_modules/uni-collapse/components/uni-collapse/uni-collapse").then(n.bind(null,"b0d7"))},uniCollapseItem:function(){return n.e("uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item").then(n.bind(null,"9c91"))},uniList:function(){return n.e("uni_modules/uni-list/components/uni-list/uni-list").then(n.bind(null,"9e5c"))},uniListItem:function(){return n.e("uni_modules/uni-list/components/uni-list-item/uni-list-item").then(n.bind(null,"24c9"))},uniDrawer:function(){return n.e("uni_modules/uni-drawer/components/uni-drawer/uni-drawer").then(n.bind(null,"68d6"))}},s=function(){var e=this.$createElement,t=(this._self._c,this.showPage&&"{}"!==JSON.stringify(this.selectedCourse)),n=t?JSON.stringify(this.selectedCourse):null,r=this.showPage&&"{}"===JSON.stringify(this.selectedCourse);this.$mp.data=Object.assign({},{$root:{g0:t,g1:n,g2:r}})},o=[]}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/studentPart/studentPart-create-component',
    {
        'components/studentPart/studentPart-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("17d5"))
        })
    },
    [['components/studentPart/studentPart-create-component']]
]);
