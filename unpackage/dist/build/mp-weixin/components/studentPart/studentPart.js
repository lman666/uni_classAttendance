(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/studentPart/studentPart"],{"17d5":function(e,t,n){"use strict";n.r(t);var r=n("d30c"),i=n("8198");for(var s in i)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(s);n("53a6");var o=n("f0c5"),u=Object(o["a"])(i["default"],r["b"],r["c"],!1,null,"20e153f1",null,!1,r["a"],void 0);t["default"]=u.exports},"2d34":function(e,t,n){"use strict";(function(e,r){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n("2eee")),o=i(n("c973")),u=n("1ef5");function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw s}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l={name:"studentPart",props:{userData:{type:Object,default:{}},token:{type:String,default:""}},data:function(){return{active:0,selectedCourse:{},stuCourseInfoList:[],currentTime:"",currentDate:"",withinTheClockingTime:!1,isPunch:!1,interval:{},stuPhoto:"",viewWidth:"",viewHeight:"",showPage:!1}},options:{styleIsolation:"shared"},created:function(){this.getCurrentDate(),setInterval(this.getNowTime,1e3),this.getCourseIdList(this.token,this.userData.code,this.userData.school)},methods:{showDrawer:function(e){this.$refs[e].open()},closeDrawer:function(e){this.$refs[e].close()},change:function(e,t){this[t]=e},punchTheClock:function(){var e=this;return(0,o.default)(s.default.mark((function t(){return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.withinTheClockingTime){t.next=4;break}e.isPunch||("定位打卡"===e.selectedCourse.method?e.positioningPunch():"普通打卡"===e.selectedCourse.method?e.clockSuccessfull():e.takePhoto()),t.next=5;break;case 4:return t.abrupt("return");case 5:case"end":return t.stop()}}),t)})))()},takePhoto:function(){var t=this;e.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["camera"],success:function(e){t.imageToBase64(e.tempFilePaths[0])}})},autoView:function(t){var n=this;e.getSystemInfo({complete:function(e){n.viewWidth=e.windowWidth+"px",n.viewHeight=e.windowHeight+"px"}})},imageToBase64:function(e){var t=this;(0,u.pathToBase64)(e).then((function(e){t.faseDetect(e)})).catch((function(e){console.error(e)}))},faseDetect:function(t){var n=this;return(0,o.default)(s.default.mark((function i(){var o,u;return s.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return o=r.importObject("clockHelper"),i.next=3,o.faseDetect(n.token,t);case 3:u=i.sent,201===u.code?n.clockSuccessfull():e.$showMsg(u.message,"error");case 5:case"end":return i.stop()}}),i)})))()},clockSuccessfull:function(){var t=this;return(0,o.default)(s.default.mark((function n(){var i,o,u;return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=r.importObject("clockHelper"),o={course_id:t.selectedCourse._id,code:t.userData.code,name:t.userData.name,date:t.currentDate},n.next=4,i.punchTheClock(t.token,o);case 4:u=n.sent,200===u.code?(e.$showMsg(u.message,"success"),t.isPunch=!0):e.$showMsg(u.message,"none");case 6:case"end":return n.stop()}}),n)})))()},positioningPunch:function(){var t=this;e.getLocation({type:"wgs84",success:function(n){console.log(n.longitude,n.latitude),console.log(t.selectedCourse.location.longitude,t.selectedCourse.location.latitude);var r=Math.abs(n.longitude-t.selectedCourse.location.longitude),i=Math.abs(n.latitude-t.selectedCourse.location.latitude);r<=.5&&i<=.5?t.clockSuccessfull():e.$showMsg("当前位置不符合打卡要求","none")}})},activeChanged:function(e){var t=this;this.active=e,clearInterval(this.interval),this.selectedCourse=this.stuCourseInfoList[e],this.$nextTick((function(){t.$refs.collapse.resize()})),this.withinTheClockingTime=!1,this.isPunch=!1,this.checkPunchOrNot()},openLocation:function(t,n){"定位打卡"===this.selectedCourse.method&&t&&n&&e.openLocation({latitude:t,longitude:n,fail:function(){e.$showMsg("地图调用失败","error")}})},getCurrentDate:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate();this.currentDate=t+"."+n+"."+r},getNowTime:function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),r=e.getSeconds();t=t<=9?"0"+t:t,n=n<=9?"0"+n:n,r=r<=9?"0"+r:r,this.currentTime=t+":"+n+":"+r},stuGetCourseInfo:function(t,n){return(0,o.default)(s.default.mark((function i(){var o,u;return s.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return o=r.importObject("courseHelper"),i.next=3,o.getCourseInfo(t,n);case 3:if(u=i.sent,403!==u.code){i.next=9;break}return e.$showMsg(u.message,"none"),i.abrupt("return");case 9:return i.abrupt("return",u);case 10:case"end":return i.stop()}}),i)})))()},checkIsWithinTheDate:function(){var e,t=this.selectedCourse.clockList,n=new Date,r=n.getDay(),i=new Map([["日",0],["一",1],["二",2],["三",3],["四",4],["五",5],["六",6]]),s=c(t);try{for(s.s();!(e=s.n()).done;){var o=e.value;if(i.get(o.date)===r)return{isPunchTheClock:!0,timeOfStart:o.timeOfStart,timeOfEnd:o.timeOfEnd}}}catch(u){s.e(u)}finally{s.f()}return{isPunchTheClock:!1}},timeStrToStamp:function(e){var t=+e.split(":")[0],n=+e.split(":")[1],r=3600*t+60*n;return r},checkIsPunchTheClock:function(e){var t=new Date,n=this.timeStrToStamp(e.timeOfStart),r=this.timeStrToStamp(e.timeOfEnd),i=3600*t.getHours()+60*t.getMinutes()+t.getSeconds();this.withinTheClockingTime=n<=i&&r>=i},checkPunchOrNot:function(){var e=this;return(0,o.default)(s.default.mark((function t(){var n,i,o;return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.checkIsWithinTheDate(),!n.isPunchTheClock){t.next=7;break}return i=r.importObject("clockHelper"),t.next=5,i.checkAlreadyPunch(e.token,e.currentDate,e.selectedCourse._id,e.userData.code);case 5:o=t.sent,o?e.isPunch=!0:e.interval=setInterval(e.checkIsPunchTheClock,1e3,n);case 7:case"end":return t.stop()}}),t)})))()},getCourseIdList:function(t,n,i){var u=this;return(0,o.default)(s.default.mark((function o(){var a,l,f,h,d,p;return s.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return a=r.importObject("courseHelper"),s.next=3,a.getCourInfoAccordingToStuInfo(t,n,i);case 3:if(l=s.sent,402!==l.code){s.next=8;break}e.$showMsg(l.message,"error"),s.next=28;break;case 8:f=c(l),s.prev=9,f.s();case 11:if((h=f.n()).done){s.next=19;break}return d=h.value,s.next=15,u.stuGetCourseInfo(t,d);case 15:p=s.sent,u.stuCourseInfoList.push(p);case 17:s.next=11;break;case 19:s.next=24;break;case 21:s.prev=21,s.t0=s["catch"](9),f.e(s.t0);case 24:return s.prev=24,f.f(),s.finish(24);case 27:u.stuCourseInfoList.length?(u.selectedCourse=u.stuCourseInfoList[0],u.checkPunchOrNot(),u.showPage=!0):u.showPage=!0;case 28:case"end":return s.stop()}}),o,null,[[9,21,24,27]])})))()}}};t.default=l}).call(this,n("543d")["default"],n("a9ff")["default"])},"3d24":function(e,t,n){},"53a6":function(e,t,n){"use strict";var r=n("3d24"),i=n.n(r);i.a},8198:function(e,t,n){"use strict";n.r(t);var r=n("2d34"),i=n.n(r);for(var s in r)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(s);t["default"]=i.a},d30c:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return r}));var r={uniCollapse:function(){return n.e("uni_modules/uni-collapse/components/uni-collapse/uni-collapse").then(n.bind(null,"b0d7"))},uniCollapseItem:function(){return n.e("uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item").then(n.bind(null,"9c91"))},uniList:function(){return n.e("uni_modules/uni-list/components/uni-list/uni-list").then(n.bind(null,"9e5c"))},uniListItem:function(){return n.e("uni_modules/uni-list/components/uni-list-item/uni-list-item").then(n.bind(null,"24c9"))},uniDrawer:function(){return n.e("uni_modules/uni-drawer/components/uni-drawer/uni-drawer").then(n.bind(null,"68d6"))}},i=function(){var e=this.$createElement,t=(this._self._c,this.showPage&&"{}"!==JSON.stringify(this.selectedCourse)),n=t?JSON.stringify(this.selectedCourse):null,r=this.showPage&&"{}"===JSON.stringify(this.selectedCourse);this.$mp.data=Object.assign({},{$root:{g0:t,g1:n,g2:r}})},s=[]}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/studentPart/studentPart-create-component',
    {
        'components/studentPart/studentPart-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("17d5"))
        })
    },
    [['components/studentPart/studentPart-create-component']]
]);
