(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/teacherPart/teacherPart"],{1229:function(t,e,n){"use strict";(function(t,i,s){var o=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=o(n("2eee")),a=o(n("c973")),u=o(n("9523")),c=o(n("b908")),l=n("26cb");function h(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var i=0,s=function(){};return{s:s,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){a=!0,o=t},f:function(){try{r||null==n.return||n.return()}finally{if(a)throw o}}}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){(0,u.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var m={components:{clockItem:function(){n.e("components/clockItem/clockItem").then(function(){return resolve(n("9d26"))}.bind(null,n)).catch(n.oe)},circleProgress:function(){n.e("components/circleProgress/circleProgress").then(function(){return resolve(n("5610"))}.bind(null,n)).catch(n.oe)}},data:function(){for(var t=new Date,e=[],n=[],i=t.getHours(),s=t.getHours(),o=[],r=[],a=t.getMinutes(),u=t.getMinutes(),c=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),l=0;l<=23;l++)l<10?(e.push("0"+l),n.push("0"+l)):(e.push(""+l),n.push(""+l));for(var h=0;h<=59;h++)h<10?(o.push("0"+h),r.push("0"+h)):(o.push(""+h),r.push(""+h));return{title:"picker-view",hoursOfStart:e,hoursOfEnd:n,hourOfStart:i,hourOfEnd:s,minutesOfStart:o,minutesOfEnd:r,minuteOfStart:a,minuteOfEnd:u,valueOfStart:[i,a],valueOfEnd:[s,u],indicatorStyle:"height: 40px;",showRight:!1,showLeft:!1,courseList:[],selectedCourse:{},active:0,isEdit:!1,isShadow:!1,mode:"",note:"",start:c,scrollTop:0,clockList:[],methodOfClock:"",staff:[],fileName:"",location:{},isUploadMethod:!1,isUploadTime:!1,isUploadStaff:!1,currentDate:"",selDate:"",showPunResCom:!1,punchResInfo:{},alreadyPunchCount:0,totalStaffCount:0,isShowCanvas:!0,options:[{text:"删除",style:{backgroundColor:"#F56C6C"}}],viewWidth:"",viewHeight:"",showPage:!1}},options:{styleIsolation:"shared"},computed:p({},(0,l.mapState)("m_user",["userInfo","token","userData"])),created:function(){var e=this;t.$on("isSDKReady",(function(t){e.updateMyProfile()})),c.default.$on("calendarCloseFn",(function(t){e.isShowCanvas=t})),this.getCurrentDate(),this.getCourseList(this.token)},methods:(0,u.default)({updateMyProfile:function(){t.$TUIKit.updateMyProfile({avatar:this.userInfo.avatar,nick:this.userInfo.nickName}).then((function(t){console.log("update",t.data)})).catch((function(t){console.warn("updateMyProfile error:",t)}))},getCurrentDate:function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1,i=t.getDate();this.currentDate=e+"-"+n+"-"+i,this.selDate=this.currentDate},confirmDate:function(t){this.selDate=t,this.calculatePunchResult()},lookUpPunchRes:function(){"{}"!==JSON.stringify(this.punchResInfo)&&t.navigateTo({url:"/page_teaPart/lookUpPunchRes/lookUpPunchRes?punchResInfo="+encodeURIComponent(JSON.stringify(this.punchResInfo))})},isShowPunchResComponent:function(){!this.isEdit&&this.isUploadMethod&&this.isUploadStaff&&this.isUploadTime?(this.showPunResCom=!0,this.calculatePunchResult()):this.showPunResCom=!1},calculatePunchResult:function(){this.punchResInfo={},this.alreadyPunchCount=0,this.totalStaffCount=0;var t,e=new Date(this.selDate),n=e.getDay(),i=!1,s=new Map([[0,"日"],[1,"一"],[2,"二"],[3,"三"],[4,"四"],[5,"五"],[6,"六"]]),o=h(this.clockList);try{for(o.s();!(t=o.n()).done;){var r=t.value;if(s.get(n)===r.date){i=!0;break}}}catch(u){o.e(u)}finally{o.f()}if(i){var a=this.calculateAlreadyPunchStaffCount();a.punch&&(this.alreadyPunchCount=a.punch.punchList.length),this.getPunchList(this.selectedCourse.staffList,a),this.totalStaffCount=this.selectedCourse.staffList.length}},getPunchList:function(t,e){this.punchResInfo.punchResList=t,this.punchResInfo.course_id=this.selectedCourse._id,this.punchResInfo.date=e.date;var n,i=h(this.punchResInfo.punchResList);try{for(i.s();!(n=i.n()).done;){var s=n.value;s.isPunch=!1}}catch(f){i.e(f)}finally{i.f()}if(e.punch){var o,r=h(e.punch.punchList);try{for(r.s();!(o=r.n()).done;){var a,u=o.value,c=h(this.punchResInfo.punchResList);try{for(c.s();!(a=c.n()).done;){var l=a.value;u.code===l.code&&(l.isPunch=!0)}}catch(f){c.e(f)}finally{c.f()}}}catch(f){r.e(f)}finally{r.f()}}},calculateAlreadyPunchStaffCount:function(){var t=this.selDate.split("-")[0],e=+this.selDate.split("-")[1],n=+this.selDate.split("-")[2],i=t+"."+e+"."+n,s={};if(s.date=i,this.selectedCourse.alreadyPunchStaffList){var o,r=h(this.selectedCourse.alreadyPunchStaffList);try{for(r.s();!(o=r.n()).done;){var a=o.value;if(i===a.date){s.punch=a;break}}}catch(u){r.e(u)}finally{r.f()}}return s},autoView:function(e){var n=this;t.getSystemInfo({complete:function(t){n.viewWidth=t.windowWidth+"px",n.viewHeight=t.windowHeight-42.5+"px"}})},showDrawer:function(t){this.isEdit||(this.isShowCanvas=!1,this.$refs[t].open())},closeDrawer:function(t){this.isShowCanvas=!0,this.$refs[t].close()},change:function(t,e){this[e]=t},addCourse:function(){this.isEdit||(this.isShowCanvas=!1,this.$refs.inputDialog.open())},dialogInputConfirm:function(e){var n=this;return(0,a.default)(r.default.mark((function s(){var o,a,u;return r.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(t.hideLoading(),""===e){s.next=13;break}return n.$refs.inputDialog.close(),n.isShowCanvas=!0,o={token:n.token,courseName:e},a=i.importObject("courseHelper"),s.next=8,a.addNewCourse(o);case 8:u=s.sent,200===u.code?t.$showMsg(u.message,"success"):(u.code,t.$showMsg(u.message,"error")),n.getCourseList(n.token),s.next=14;break;case 13:t.$showMsg("请输入课程名","none");case 14:case"end":return s.stop()}}),s)})))()},dialogInputCourseClose:function(){this.$refs.inputDialog.close(),this.isShowCanvas=!0},getCourseList:function(e){var n=this;return(0,a.default)(r.default.mark((function s(){var o,a;return r.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return o=i.importObject("courseHelper"),s.next=3,o.getCourseList(e);case 3:a=s.sent,201===a.code?(a.data.length&&(n.courseList=a.data,n.getCourseInfo(e,n.courseList[0]._id)),n.showPage=!0):402===a.code&&t.$showMsg(a.message,"error");case 5:case"end":return s.stop()}}),s)})))()},getCourseInfo:function(e,n){var s=this;return(0,a.default)(r.default.mark((function o(){var a,u;return r.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return a=i.importObject("courseHelper"),o.next=3,a.getCourseInfo(e,n);case 3:u=o.sent,403===u.code?t.$showMsg(u.message,"none"):(s.selectedCourse=u,s.selectedCourse.clockList&&(s.clockList=s.selectedCourse.clockList),s.isUploadTime=!1,s.isUploadMethod=!1,s.isUploadStaff=!1,void 0!==s.selectedCourse.clockList&&(s.isUploadTime=!0),void 0!==s.selectedCourse.staffList&&(s.isUploadStaff=!0),""!==s.selectedCourse.method&&(s.isUploadMethod=!0),s.isShowPunchResComponent());case 5:case"end":return o.stop()}}),o)})))()},openLocation:function(e,n){"定位打卡"===this.selectedCourse.method&&e&&n&&t.openLocation({latitude:e,longitude:n,success:function(){console.log("success")}})},selectMethodOfClock:function(t){this.methodOfClock=t,"定位打卡"===t?this.getMapLocation():(this.location={},this.upLoadMethod()),this.$refs.popupMethod.close(),this.isShowCanvas=!0},getMapLocation:function(){var e=this;t.getSetting({success:function(n){n.authSetting["scope.userLocation"]?t.chooseLocation({success:function(t){e.location.name=t.name,e.location.address=t.address,e.location.latitude=t.latitude,e.location.longitude=t.longitude,e.upLoadMethod()},fail:function(){t.$showMsg("获取定位失败或用户取消","none")}}):void 0===n.authSetting["scope.userLocation"]&&t.authorize({scope:"scope.userLocation",success:function(n){t.chooseLocation({success:function(t){e.location.name=t.name,e.location.address=t.address,e.location.latitude=t.latitude,e.location.longitude=t.longitude,e.upLoadMethod()},fail:function(){t.$showMsg("获取定位失败或用户取消","none")}})}})},fail:function(){t.$showMsg("获取授权信息失败","none")}})},upLoadMethod:function(){var e=this;return(0,a.default)(r.default.mark((function n(){var s,o;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return s=i.importObject("courseHelper"),n.next=3,s.addMethod(e.token,e.methodOfClock,e.location,e.selectedCourse._id);case 3:o=n.sent,0!==o.updated&&void 0===o.code?(e.isUploadMethod=!0,t.$showMsg("更新成功","success")):403===o.code&&t.$showMsg("更新失败","none");case 5:case"end":return n.stop()}}),n)})))()},activeChanged:function(t){this.active=t,this.clockList=[],this.getCourseInfo(this.token,this.courseList[t]._id)},changeEditStatus:function(){this.isEdit?this.isUploadMethod&&this.isUploadStaff&&this.isUploadTime?(this.isEdit=!1,this.isShadow=!1,this.getCourseInfo(this.token,this.selectedCourse._id)):t.$showMsg("请设置完全部项","none"):(this.isEdit=!0,this.isShadow=!0)},toggle:function(e,n){var i=this;this.isEdit?(this.mode=n,"time"===n?(this.isShowCanvas=!1,this.$refs.popupTime.open(e)):"method"===n?(this.isShowCanvas=!1,this.$refs.popupMethod.open(e)):"staff"===n&&s.chooseMessageFile({count:1,type:"file",success:function(e){var n=e.tempFiles[0].name.substring(e.tempFiles[0].name.lastIndexOf(".")+1);if("xlsx"!==n&&"xls"!==n)t.$showMsg("选择的文件不是excel文件，请重新选择!","none");else{i.fileName=e.tempFiles[0].name;var s=e.tempFiles[0].path;i.uploadExcel(s,n)}},fail:function(t){console.log(t)}})):"time"===n?this.selectedCourse.clockList&&(this.isShowCanvas=!1,this.$refs.popupAttendanceTime.open("center")):"method"===n?this.selectedCourse.method&&(this.isShowCanvas=!1,this.$refs.popupAttendanceMethod.open("center")):this.selectedCourse.staffList&&t.navigateTo({url:"/page_teaPart/lookUpStaff/lookUpStaff?staff="+encodeURIComponent(JSON.stringify(this.selectedCourse.staffList))})},uploadExcel:function(e,n){var s=this;i.uploadFile({filePath:e,cloudPath:(new Date).getTime()+"."+n,success:function(t){s.parseFile(t.fileID)},fail:function(){t.$showMsg("文件上传失败","error")}})},parseFile:function(e){var n=this;return(0,a.default)(r.default.mark((function s(){var o,a;return r.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return o=i.importObject("parseExcel"),s.next=3,o.parseF(e,n.selectedCourse._id,n.token);case 3:a=s.sent,200===a.code?(n.isUploadStaff=!0,t.$showMsg("解析文件成功","success")):t.$showMsg("解析文件失败","none");case 5:case"end":return s.stop()}}),s)})))()},maskClick:function(){this.isShowCanvas=!0},timeClose:function(){var e=this;return(0,a.default)(r.default.mark((function n(){var s,o;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!e.chackClockList()){n.next=14;break}if("[]"===JSON.stringify(e.clockList)){n.next=11;break}return s=i.importObject("courseHelper"),n.next=5,s.addClockList(e.token,e.clockList,e.selectedCourse._id);case 5:o=n.sent,200===o.code?(e.isUploadTime=!0,t.$showMsg(o.message,"success")):t.$showMsg(o.message,"error"),e.$refs.popupTime.close(),e.isShowCanvas=!0,n.next=12;break;case 11:t.$showMsg("请设置打卡时间","none");case 12:n.next=15;break;case 14:t.$showMsg("日期存在冲突，请重新设置","none");case 15:case"end":return n.stop()}}),n)})))()},timeOk:function(){if(+this.hourOfStart>+this.hourOfEnd||+this.hourOfStart>+this.hourOfEnd&&+this.minuteOfStart>=+this.minuteOfEnd||+this.hourOfStart===+this.hourOfEnd&&+this.minuteOfStart>=+this.minuteOfEnd)t.$showMsg("时间有误，请重新设置","none");else if(""===this.note)t.$showMsg("请选择打卡日期","none");else{var e=this.clockInfoToStr(this.hourOfStart,this.minuteOfStart,this.hourOfEnd,this.minuteOfEnd),n=p(p({},e),{},{date:this.note.substring(2)});this.clockList.push(n),this.note=""}},swipeItemClickHandler:function(t){for(var e=t+1;e<this.clockList.length;e++)this.clockList[e-1]=this.clockList[e];this.clockList.pop()},chackClockList:function(){var t,e=new Set,n=0,i=h(this.clockList);try{for(i.s();!(t=i.n()).done;){var s=t.value,o=s.date;if(o.length>1){var r,a=o.split("、"),u=h(a);try{for(u.s();!(r=u.n()).done;){var c=r.value;if(e.has(c)){n=1;break}e.add(c)}}catch(l){u.e(l)}finally{u.f()}}else{if(e.has(o)){n=1;break}e.add(o)}if(1===n)return!1}}catch(l){i.e(l)}finally{i.f()}return 1!==n},clockInfoToStr:function(t,e,n,i){var s=this.wordToStr(t),o=this.wordToStr(e),r=this.wordToStr(n),a=this.wordToStr(i);return{timeOfStart:s+":"+o,timeOfEnd:r+":"+a}},wordToStr:function(t){return"string"===typeof t?1===t.length&&(t="0"+t):t=t<10?"0"+t:""+t,t},bindChangeOfStart:function(t){var e=t.detail.value;this.hourOfStart=this.hoursOfStart[e[0]],this.minuteOfStart=this.minutesOfStart[e[1]]},bindChangeOfEnd:function(t){var e=t.detail.value;this.hourOfEnd=this.hoursOfEnd[e[0]],this.minuteOfEnd=this.minutesOfEnd[e[1]]},selectDate:function(){t.navigateTo({url:"/page_teaPart/selRecurDate/selRecurDate"})},regionBindClick:function(t){if(0!==t.length){var e=t.join("、");this.note=e}else this.note=""},changeDate:function(t){this.noteOfDate=t,this.note=this.noteOfDate}},"regionBindClick",(function(t){if(0!==t.length){var e="每周"+t.join("、");this.note=e}else this.note=""}))};e.default=m}).call(this,n("543d")["default"],n("a9ff")["default"],n("bc2e")["default"])},"30b4":function(t,e,n){"use strict";n.r(e);var i=n("cd61"),s=n("6805");for(var o in s)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(o);n("e20f");var r=n("f0c5"),a=Object(r["a"])(s["default"],i["b"],i["c"],!1,null,"730dfceb",null,!1,i["a"],void 0);e["default"]=a.exports},"35f5":function(t,e,n){},6805:function(t,e,n){"use strict";n.r(e);var i=n("1229"),s=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=s.a},cd61:function(t,e,n){"use strict";n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return i}));var i={uniCard:function(){return n.e("uni_modules/uni-card/components/uni-card/uni-card").then(n.bind(null,"a0c7"))},uniList:function(){return n.e("uni_modules/uni-list/components/uni-list/uni-list").then(n.bind(null,"9e5c"))},uniListItem:function(){return n.e("uni_modules/uni-list/components/uni-list-item/uni-list-item").then(n.bind(null,"24c9"))},uniDatetimePicker:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker")]).then(n.bind(null,"7d0d"))},circleProgress:function(){return n.e("components/circleProgress/circleProgress").then(n.bind(null,"5610"))},uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"7cfd"))},uniSwipeAction:function(){return n.e("uni_modules/uni-swipe-action/components/uni-swipe-action/uni-swipe-action").then(n.bind(null,"1422"))},uniSwipeActionItem:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-swipe-action/components/uni-swipe-action-item/uni-swipe-action-item")]).then(n.bind(null,"8063"))},clockItem:function(){return n.e("components/clockItem/clockItem").then(n.bind(null,"9d26"))},uniPopupDialog:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog")]).then(n.bind(null,"8bf8"))},uniDrawer:function(){return n.e("uni_modules/uni-drawer/components/uni-drawer/uni-drawer").then(n.bind(null,"68d6"))}},s=function(){var t=this.$createElement,e=(this._self._c,JSON.stringify(this.selectedCourse)),n=this.showPage&&"{}"!==JSON.stringify(this.selectedCourse),i=n?JSON.stringify(this.selectedCourse):null,s=this.showPage&&"[]"===JSON.stringify(this.courseList);this.$mp.data=Object.assign({},{$root:{g0:e,g1:n,g2:i,g3:s}})},o=[]},e20f:function(t,e,n){"use strict";var i=n("35f5"),s=n.n(i);s.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/teacherPart/teacherPart-create-component',
    {
        'components/teacherPart/teacherPart-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("30b4"))
        })
    },
    [['components/teacherPart/teacherPart-create-component']]
]);
